{% extends 'base.html' %}

{% block content %}
{% if current_user.is_authenticated %}
<section>
  <h1>Homepage</h1>
  <div class="feed">
    <h2>Businesses</h2>
    {% for business in businesses %}
      <div class="post">
        <h3><a href="{{ url_for('business.business_profile', business_id=business.id) }}">{{business.business_name}}</a></h3>
        <h4>{{ business.decription }}</h4>
        <p>Location: {{business.state}}, {{business.country}}</p>
      </div>
    {% endfor %}
</section><hr>
<section>
    <h2>Posts</h2>
    {% for post in posts %}
      <div class="post">
        <p>{{ post.created_at }}</p>
        <h3><a href="{{ url_for('business.business_profile', business_id=post.business_id) }}">{{ post.business.business_name }}</a></h3>
        <h4>{{ post.title }}</h4>
        <p>{{ post.content }}</p>
        <p>Likes: {{ post.engagements | selectattr('engagement_type', 'equalto', 'like') | list | length }}</p>
        <p>Comments: {{ post.engagements | selectattr('engagement_type', 'equalto', 'comment') | list | length }}</p>
        <p><a href="{{ url_for('post.post_detail', post_id=post.id) }}">View Post</a></p>
      </div>
    {% endfor %}
</section><hr>
<section> 
    <h2>Requests</h2>
    {% for request in requests %}
      <div class="post">
        <p>{{ request.created_at }}</p>
        <h3>{{ request_users[request.id].username }}</h3>
        <h4>{{ request.category }}</h4>
        <p>{{ request.content }}</p>
        <a href="{{ url_for('request.view_request', request_id=request.id) }}">View Request</a>
      </div>
    {% endfor %}
</section><hr>
    <a href="{{ url_for('auth.logout') }}">Log out</a>
  </div>
{% else %}
  <p><a href="{{ url_for('auth.login') }}">Login</a></p>
  <p><a href="{{ url_for('auth.register') }}">Register</a></p>
{% endif %}
<!--  <p><a href="{{ url_for('user.profile') }}">Profile</a></p>
  <p><a href="{{ url_for('message.inbox') }}">Inbox</a></p> -->
{% endblock %}
